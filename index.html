<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR –í–∏–¥–µ–æ –≤ –†–µ–∞–ª—å–Ω–æ–º –ú–∏—Ä–µ</title>
    
    <!-- Three.js –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- AR.js –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- MediaPipe –¥–ª—è —Ä—É–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .screen.active {
            display: flex;
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .menu-content {
            max-width: 500px;
            margin: auto;
            width: 90%;
            padding: 30px 20px;
            text-align: center;
        }
        
        h1 {
            color: #4cc9f0;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #a5b4cb;
            margin-bottom: 40px;
            line-height: 1.5;
            font-size: 16px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 12px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* AR —ç–∫—Ä–∞–Ω */
        #arScreen {
            padding: 0;
            background: #000;
        }
        
        #arView {
            width: 100%;
            height: 100%;
            display: none;
        }
        
        #arView.active {
            display: block;
        }
        
        /* Canvas –¥–ª—è —Ä—É–∫ */
        #handCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1001;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .control-btn:active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∂–µ—Å—Ç–æ–≤ */
        .gesture-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1001;
        }
        
        .gesture-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .gesture-icon {
            font-size: 20px;
            margin-right: 10px;
            width: 30px;
        }
        
        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1001;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-dot.green {
            background: #4CAF50;
        }
        
        .status-dot.red {
            background: #f44336;
        }
        
        /* –í–∏–¥–µ–æ –ø–ª–∞—à–∫–∞ */
        .video-info {
            position: absolute;
            top: 60px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1001;
            max-width: 200px;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top-color: #4cc9f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 480px) {
            .control-panel {
                bottom: 10px;
                padding: 12px 20px;
                gap: 12px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .gesture-indicator {
                display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
            }
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="mainScreen" class="screen active">
        <div class="menu-content">
            <h1>üé• AR –í–∏–¥–µ–æ –≤ –†–µ–∞–ª—å–Ω–æ–º –ú–∏—Ä–µ</h1>
            <p class="subtitle">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤–∏–¥–µ–æ –≤ –≤–∞—à–µ–π –∫–æ–º–Ω–∞—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –∂–µ—Å—Ç–∞–º–∏</p>
            
            <button id="startAR" class="btn btn-primary">
                üì± –ó–∞–ø—É—Å—Ç–∏—Ç—å AR –ö–∞–º–µ—Ä—É
            </button>
            
            <button id="loadVideo" class="btn btn-secondary">
                üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
            </button>
            
            <button id="loadYouTube" class="btn btn-secondary">
                üì∫ YouTube –≤–∏–¥–µ–æ
            </button>
            
            <div style="margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px;">
                <h3 style="color: #4cc9f0; margin-bottom: 15px;">‚úã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–µ—Å—Ç–∞–º–∏:</h3>
                <div style="text-align: left;">
                    <p>ü§è <strong>–©–µ–ø–æ—Ç–∫–∞</strong> - –∑–∞—Ö–≤–∞—Ç –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</p>
                    <p>‚úã <strong>–õ–∞–¥–æ–Ω—å</strong> - –ø–∞—É–∑–∞</p>
                    <p>‚úä <strong>–ö—É–ª–∞–∫</strong> - –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</p>
                    <p>üëÜüëá <strong>–ü–∞–ª—å—Ü—ã</strong> - –≥—Ä–æ–º–∫–æ—Å—Ç—å +/-</p>
                </div>
            </div>
            
            <div style="margin-top: 20px; color: #888; font-size: 14px;">
                <p>üì± –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É –¥–ª—è AR</p>
                <p>üè† –í–∏–¥–µ–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –∫–æ–º–Ω–∞—Ç–µ –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è</p>
            </div>
        </div>
    </div>

    <!-- AR —ç–∫—Ä–∞–Ω -->
    <div id="arScreen" class="screen">
        <!-- A-Frame AR —Å—Ü–µ–Ω–∞ -->
        <div id="arView"></div>
        
        <!-- Canvas –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É–∫ -->
        <canvas id="handCanvas"></canvas>
        
        <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot green" id="arStatus"></div>
                <span>AR –∞–∫—Ç–∏–≤–µ–Ω</span>
            </div>
            <div class="status-item">
                <div class="status-dot green" id="handStatus"></div>
                <span>–ñ–µ—Å—Ç—ã: –≤–∫–ª</span>
            </div>
            <button id="backBtn" class="btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ -->
        <div class="video-info" id="videoInfo">
            <div style="font-size: 12px; color: #4cc9f0;">üìπ –¢–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ:</div>
            <div id="currentVideoName" style="font-size: 14px; margin-top: 5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∂–µ—Å—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) -->
        <div class="gesture-indicator">
            <div class="gesture-item">
                <div class="gesture-icon">ü§è</div>
                <div>–ó–∞—Ö–≤–∞—Ç/–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</div>
            </div>
            <div class="gesture-item">
                <div class="gesture-icon">‚úã</div>
                <div>–ü–∞—É–∑–∞</div>
            </div>
            <div class="gesture-item">
                <div class="gesture-icon">‚úä</div>
                <div>–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</div>
            </div>
            <div class="gesture-item">
                <div class="gesture-icon">üëÜ</div>
                <div>–ì—Ä–æ–º–∫–æ—Å—Ç—å +</div>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="control-panel">
            <button class="control-btn" id="playPauseBtn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">
                ‚è∏Ô∏è
            </button>
            <button class="control-btn" id="volumeBtn" title="–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫">
                üîä
            </button>
            <button class="control-btn" id="deleteBtn" title="–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ" style="color: #ff6b6b;">
                üóëÔ∏è
            </button>
            <button class="control-btn" id="resetBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é">
                üîÑ
            </button>
        </div>
        
        <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <div style="margin-top: 20px; font-size: 18px;">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR...</div>
            <div style="margin-top: 10px; font-size: 14px; color: #a5b4cb;" id="loadingText">
                –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ -->
    <div id="videoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; justify-content: center; align-items: center;">
        <div style="background: #1a1a2e; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%;">
            <h2 style="color: #4cc9f0; margin-bottom: 20px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ</h2>
            
            <div style="margin: 20px 0;">
                <input type="file" id="videoFileInput" accept="video/*" style="display: none;">
                <button id="selectFileBtn" class="btn btn-secondary" style="margin-bottom: 10px;">
                    üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                </button>
                
                <div style="margin: 20px 0; text-align: center; color: #a5b4cb;">
                    –∏–ª–∏
                </div>
                
                <input type="text" id="youtubeUrlInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É YouTube..." 
                       style="width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 10px; border: 2px solid #4cc9f0; background: rgba(255,255,255,0.1); color: white;">
                <button id="loadYoutubeBtn" class="btn btn-primary">
                    üì∫ –ó–∞–≥—Ä—É–∑–∏—Ç—å YouTube –≤–∏–¥–µ–æ
                </button>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="cancelBtn" class="btn btn-secondary" style="flex: 1;">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button id="confirmBtn" class="btn btn-primary" style="flex: 1;" disabled>
                    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentVideoUrl = null;
        let currentVideoName = "YouTube –≤–∏–¥–µ–æ";
        let isARActive = false;
        let handDetector = null;
        let handCanvas, handCtx;
        let isGrabbing = false;
        let videoElement = null;
        let videoPlaced = false;
        let videoEntity = null;
        let arScene = null;
        
        // –ü–æ–∑–∏—Ü–∏—è –≤–∏–¥–µ–æ –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
        let videoWorldPosition = { x: 0, y: 0, z: -2 };
        let videoWorldRotation = { x: 0, y: 0, z: 0 };
        let videoScale = 1;
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            setupEventListeners();
        });
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ==========
        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('startAR').addEventListener('click', startARExperience);
            document.getElementById('loadVideo').addEventListener('click', showVideoModal);
            document.getElementById('loadYouTube').addEventListener('click', showVideoModal);
            document.getElementById('backBtn').addEventListener('click', goBackToMenu);
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–µ–æ
            document.getElementById('selectFileBtn').addEventListener('click', () => {
                document.getElementById('videoFileInput').click();
            });
            
            document.getElementById('videoFileInput').addEventListener('change', handleVideoFileSelect);
            document.getElementById('loadYoutubeBtn').addEventListener('click', handleYouTubeUrl);
            document.getElementById('cancelBtn').addEventListener('click', hideVideoModal);
            document.getElementById('confirmBtn').addEventListener('click', confirmVideoSelection);
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AR
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('volumeBtn').addEventListener('click', toggleVolume);
            document.getElementById('deleteBtn').addEventListener('click', deleteVideo);
            document.getElementById('resetBtn').addEventListener('click', resetVideoPosition);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–∞—Å–∞–Ω–∏–π
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
            document.getElementById('videoModal').addEventListener('click', function(e) {
                if (e.target === this) hideVideoModal();
            });
        }
        
        // ========== –ó–ê–ü–£–°–ö AR –û–ü–´–¢–ê ==========
        async function startARExperience() {
            if (!currentVideoUrl) {
                showVideoModal();
                return;
            }
            
            console.log('üöÄ –ó–∞–ø—É—Å–∫ AR –æ–ø—ã—Ç–∞ —Å –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–æ–π...');
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ AR —ç–∫—Ä–∞–Ω
            switchScreen('arScreen');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = '–í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã...';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AR —Å—Ü–µ–Ω—É
            await initARScene();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É–∫
            await initHandTracking();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 1000);
            
            showMessage('AR –∫–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –ò—â–∏—Ç–µ –ø–ª–æ—Å–∫—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å.', 'success');
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø AR –°–¶–ï–ù–´ –° –ó–ê–î–ù–ï–ô –ö–ê–ú–ï–†–û–ô ==========
        async function initARScene() {
            console.log('üì± –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR —Å –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–æ–π...');
            
            const arView = document.getElementById('arView');
            arView.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º A-Frame —Å—Ü–µ–Ω—É —Å –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–æ–π
            arView.innerHTML = `
                <a-scene 
                    embedded 
                    arjs="sourceType: webcam; sourceWidth: 1280; sourceHeight: 720; displayWidth: 1280; displayHeight: 720; debugUIEnabled: false;"
                    vr-mode-ui="enabled: false"
                    renderer="logarithmicDepthBuffer: true; precision: medium;"
                    gesture-detector
                >
                    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö -->
                    <a-entity camera="userHeight: 1.6;" position="0 1.6 0" look-controls>
                        <!-- –ú–∞—Ä–∫–µ—Ä –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤–∏–¥–µ–æ -->
                        <a-entity cursor="rayOrigin: mouse" 
                                 raycaster="objects: .clickable; showLine: false"
                                 position="0 0 -1">
                        </a-entity>
                    </a-entity>
                    
                    <!-- –ú–∞—Ä–∫–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ -->
                    <a-marker-camera preset="hiro"></a-marker-camera>
                    
                    <!-- –°–µ—Ç–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π -->
                    <a-entity geometry="primitive: plane; width: 100; height: 100" 
                             rotation="-90 0 0"
                             material="color: #333; opacity: 0.5; transparent: true"
                             visible="false"
                             class="floor">
                    </a-entity>
                    
                    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤–∏–¥–µ–æ -->
                    <a-entity id="videoContainer"></a-entity>
                    
                </a-scene>
            `;
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
            return new Promise((resolve) => {
                arView.addEventListener('loaded', function() {
                    arScene = arView.querySelector('a-scene');
                    console.log('‚úÖ AR —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–º–µ—Ä—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
                    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                        navigator.mediaDevices.enumerateDevices().then(devices => {
                            const videoDevices = devices.filter(device => device.kind === 'videoinput');
                            if (videoDevices.length > 1) {
                                console.log('üì∑ –ù–∞–π–¥–µ–Ω—ã –∫–∞–º–µ—Ä—ã:', videoDevices.length);
                                // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∑–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –æ–±—ã—á–Ω–æ –∏–º–µ–µ—Ç –º–µ—Ç–∫—É "back" –∏–ª–∏ "environment"
                                const backCamera = videoDevices.find(device => 
                                    device.label.toLowerCase().includes('back') || 
                                    device.label.toLowerCase().includes('rear') ||
                                    device.label.toLowerCase().includes('environment')
                                );
                                
                                if (backCamera) {
                                    console.log('üì∑ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É:', backCamera.label);
                                }
                            }
                        });
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –≤ —Å—Ü–µ–Ω—É
                    loadVideoIntoScene();
                    resolve();
                });
            });
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û –í AR –°–¶–ï–ù–£ ==========
        function loadVideoIntoScene() {
            console.log('üé• –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ AR —Å—Ü–µ–Ω—É...');
            
            const videoContainer = document.querySelector('#videoContainer');
            if (!videoContainer) return;
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤–∏–¥–µ–æ
            videoContainer.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
            videoElement = document.createElement('video');
            videoElement.src = currentVideoUrl;
            videoElement.crossOrigin = 'anonymous';
            videoElement.loop = true;
            videoElement.muted = true;
            videoElement.playsInline = true;
            videoElement.setAttribute('webkit-playsinline', '');
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —Ç–µ–∫—Å—Ç—É—Ä—É
            const videoTexture = new THREE.VideoTexture(videoElement);
            videoTexture.minFilter = THREE.LinearFilter;
            videoTexture.magFilter = THREE.LinearFilter;
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
            videoElement.addEventListener('loadedmetadata', function() {
                console.log('üìê –†–∞–∑–º–µ—Ä—ã –≤–∏–¥–µ–æ:', videoElement.videoWidth, 'x', videoElement.videoHeight);
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤–∏–¥–µ–æ
                const aspectRatio = videoElement.videoWidth / videoElement.videoHeight;
                const width = 1.6; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö
                const height = width / aspectRatio;
                
                console.log('üìè –†–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –≤ AR:', width.toFixed(2), 'x', height.toFixed(2), '–º');
                
                // –°–æ–∑–¥–∞–µ–º –ø–ª–æ—Å–∫–æ—Å—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏ –≤–∏–¥–µ–æ
                const videoPlane = document.createElement('a-entity');
                videoPlane.setAttribute('geometry', {
                    primitive: 'plane',
                    width: width,
                    height: height
                });
                
                videoPlane.setAttribute('material', {
                    src: '#videoTexture',
                    transparent: true,
                    opacity: 1
                });
                
                videoPlane.setAttribute('position', {
                    x: videoWorldPosition.x,
                    y: videoWorldPosition.y,
                    z: videoWorldPosition.z
                });
                
                videoPlane.setAttribute('rotation', {
                    x: videoWorldRotation.x,
                    y: videoWorldRotation.y,
                    z: videoWorldRotation.z
                });
                
                videoPlane.setAttribute('scale', videoScale + ' ' + videoScale + ' ' + videoScale);
                videoPlane.setAttribute('class', 'clickable video-plane');
                videoPlane.setAttribute('id', 'arVideo');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –≤ —Å—Ü–µ–Ω—É
                videoContainer.appendChild(videoPlane);
                videoEntity = videoPlane;
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –¥–ª—è A-Frame
                const sceneEl = document.querySelector('a-scene');
                const texture = new THREE.VideoTexture(videoElement);
                sceneEl.systems.material.registerTexture('videoTexture', texture);
                
                // –ù–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                videoElement.play().catch(e => {
                    console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ');
                    showMessage('–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É Play –¥–ª—è –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è', 'info');
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
                document.getElementById('currentVideoName').textContent = currentVideoName;
                
                console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ AR —Å—Ü–µ–Ω—É');
                videoPlaced = true;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤–∏–¥–µ–æ –ø–æ –∫–∞—Å–∞–Ω–∏—é
                setupVideoPlacement();
            });
            
            videoElement.load();
        }
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ê –†–ê–ó–ú–ï–©–ï–ù–ò–Ø –í–ò–î–ï–û –ü–û –ö–ê–°–ê–ù–ò–Æ ==========
        function setupVideoPlacement() {
            const sceneEl = document.querySelector('a-scene');
            if (!sceneEl) return;
            
            sceneEl.addEventListener('click', function(evt) {
                if (!videoEntity || evt.detail.intersection.point) {
                    // –†–∞–∑–º–µ—â–∞–µ–º –≤–∏–¥–µ–æ –≤ —Ç–æ—á–∫–µ –∫–∞—Å–∞–Ω–∏—è
                    const point = evt.detail.intersection.point;
                    if (point && videoEntity) {
                        videoEntity.setAttribute('position', {
                            x: point.x,
                            y: point.y + 0.8, // –ù–µ–º–Ω–æ–≥–æ –≤—ã—à–µ —Ç–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è
                            z: point.z
                        });
                        
                        // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                        const camera = document.querySelector('[camera]');
                        if (camera) {
                            const cameraPos = camera.getAttribute('position');
                            const direction = {
                                x: cameraPos.x - point.x,
                                y: 0,
                                z: cameraPos.z - point.z
                            };
                            
                            // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞
                            const angle = Math.atan2(direction.x, direction.z) * (180 / Math.PI);
                            videoEntity.setAttribute('rotation', {
                                x: 0,
                                y: angle,
                                z: 0
                            });
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
                        videoWorldPosition = { x: point.x, y: point.y + 0.8, z: point.z };
                        videoWorldRotation = { x: 0, y: angle, z: 0 };
                        
                        showMessage('‚úÖ –í–∏–¥–µ–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ –≤ –∫–æ–º–Ω–∞—Ç–µ!', 'success');
                    }
                }
            });
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø –†–£–ö ==========
        async function initHandTracking() {
            console.log('‚úã –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É–∫...');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º canvas –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ä—É–∫
            handCanvas = document.getElementById('handCanvas');
            handCtx = handCanvas.getContext('2d');
            handCanvas.width = window.innerWidth;
            handCanvas.height = window.innerHeight;
            
            // –°–æ–∑–¥–∞–µ–º –¥–µ—Ç–µ–∫—Ç–æ—Ä —Ä—É–∫
            handDetector = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });
            
            handDetector.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.6
            });
            
            handDetector.onResults(onHandResults);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å –≤–µ–±-–∫–∞–º–µ—Ä—ã
            const cameraVideo = document.createElement('video');
            cameraVideo.style.display = 'none';
            document.body.appendChild(cameraVideo);
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ
                const constraints = {
                    video: {
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraVideo.srcObject = stream;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–¥—Ä–æ–≤
                const camera = new Camera(cameraVideo, {
                    onFrame: async () => {
                        if (isARActive && handDetector) {
                            await handDetector.send({ image: cameraVideo });
                        }
                    },
                    width: 640,
                    height: 480
                });
                
                await camera.start();
                console.log('‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–æ–π');
                document.getElementById('handStatus').className = 'status-dot green';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                document.getElementById('handStatus').className = 'status-dot red';
                document.getElementById('handStatus').nextElementSibling.textContent = '–ñ–µ—Å—Ç—ã: –≤—ã–∫–ª';
            }
        }
        
        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø –†–£–ö ==========
        function onHandResults(results) {
            // –û—á–∏—â–∞–µ–º canvas
            handCtx.clearRect(0, 0, handCanvas.width, handCanvas.height);
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0 && videoEntity) {
                const landmarks = results.multiHandLandmarks[0];
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä—É–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                drawHandSkeleton(landmarks);
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∂–µ—Å—Ç—ã
                analyzeHandGestures(landmarks);
            }
        }
        
        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ö–ï–õ–ï–¢–ê –†–£–ö–ò ==========
        function drawHandSkeleton(landmarks) {
            // –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ —Ä—É–∫–∏
            const connections = [
                [0, 1], [1, 2], [2, 3], [3, 4],
                [0, 5], [5, 6], [6, 7], [7, 8],
                [5, 9], [9, 10], [10, 11], [11, 12],
                [9, 13], [13, 14], [14, 15], [15, 16],
                [13, 17], [17, 18], [18, 19], [19, 20],
                [17, 0]
            ];
            
            handCtx.strokeStyle = '#00FF00';
            handCtx.lineWidth = 2;
            
            connections.forEach(([i, j]) => {
                const start = landmarks[i];
                const end = landmarks[j];
                
                handCtx.beginPath();
                handCtx.moveTo(start.x * handCanvas.width, start.y * handCanvas.height);
                handCtx.lineTo(end.x * handCanvas.width, end.y * handCanvas.height);
                handCtx.stroke();
            });
            
            // –¢–æ—á–∫–∏
            landmarks.forEach(landmark => {
                handCtx.beginPath();
                handCtx.arc(
                    landmark.x * handCanvas.width,
                    landmark.y * handCanvas.height,
                    4, 0, Math.PI * 2
                );
                handCtx.fillStyle = '#FF0000';
                handCtx.fill();
            });
        }
        
        // ========== –ê–ù–ê–õ–ò–ó –ñ–ï–°–¢–û–í –†–£–ö–ò ==========
        function analyzeHandGestures(landmarks) {
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            const wrist = landmarks[0];
            
            // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —â–µ–ø–æ—Ç–∫—É (–∑–∞—Ö–≤–∞—Ç)
            const pinchDistance = Math.sqrt(
                Math.pow(thumbTip.x - indexTip.x, 2) + 
                Math.pow(thumbTip.y - indexTip.y, 2)
            );
            
            if (pinchDistance < 0.03) { // –©–µ–ø–æ—Ç–∫–∞
                if (!isGrabbing) {
                    isGrabbing = true;
                    showMessage('ü§è –ó–∞—Ö–≤–∞—á–µ–Ω–æ - –¥–≤–∏–≥–∞–π—Ç–µ —Ä—É–∫–æ–π', 'info');
                }
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä—É–∫–∏ –≤ –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                const screenX = wrist.x;
                const screenY = wrist.y;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤–∏–¥–µ–æ –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
                updateVideoWorldPosition(screenX, screenY);
                
            } else {
                if (isGrabbing) {
                    isGrabbing = false;
                    showMessage('üñêÔ∏è –û—Ç–ø—É—â–µ–Ω–æ', 'info');
                }
            }
            
            // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–∫—Ä—ã—Ç—É—é –ª–∞–¥–æ–Ω—å (–ø–∞—É–∑–∞)
            const fingersUp = countFingersUp(landmarks);
            if (fingersUp >= 4 && videoElement) { // –í—Å–µ –ø–∞–ª—å—Ü—ã –ø–æ–¥–Ω—è—Ç—ã
                if (!videoElement.paused) {
                    videoElement.pause();
                    showMessage('‚úã –ü–∞—É–∑–∞', 'info');
                }
            }
            
            // 3. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—É–ª–∞–∫ (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ)
            if (fingersUp <= 1 && videoElement) { // –í—Å–µ –ø–∞–ª—å—Ü—ã —Å–∂–∞—Ç—ã
                if (videoElement.paused) {
                    videoElement.play();
                    showMessage('‚úä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ', 'info');
                }
            }
            
            // 4. V –∑–Ω–∞–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç—å—é
            if (isVSign(landmarks) && videoElement) {
                videoElement.volume = Math.min(1, videoElement.volume + 0.1);
                showMessage('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å +', 'info');
            }
            
            // 5. –û–ø—É—â–µ–Ω–Ω—ã–µ –ø–∞–ª—å—Ü—ã –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            if (isFingersDown(landmarks) && videoElement) {
                videoElement.volume = Math.max(0, videoElement.volume - 0.1);
                showMessage('üîâ –ì—Ä–æ–º–∫–æ—Å—Ç—å -', 'info');
            }
        }
        
        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ú–ò–†–û–í–û–ô –ü–û–ó–ò–¶–ò–ò –í–ò–î–ï–û ==========
        function updateVideoWorldPosition(screenX, screenY) {
            if (!videoEntity) return;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–∫—Ä–∞–Ω–∞ –≤ –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            // –≠—Ç–∞ —á–∞—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –∏ –º–æ–∂–µ—Ç –Ω—É–∂–¥–∞—Ç—å—Å—è –≤ –¥–æ—Ä–∞–±–æ—Ç–∫–µ
            const worldX = (screenX - 0.5) * 4; // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è AR
            const worldY = (0.5 - screenY) * 3;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏—Ä–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            videoWorldPosition.x = worldX;
            videoWorldPosition.y = worldY + 1; // –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –∫ –≤–∏–¥–µ–æ
            videoEntity.setAttribute('position', {
                x: videoWorldPosition.x,
                y: videoWorldPosition.y,
                z: videoWorldPosition.z
            });
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ñ–ï–°–¢–û–í ==========
        function countFingersUp(landmarks) {
            const fingerTips = [8, 12, 16, 20];
            const fingerMCPs = [5, 9, 13, 17];
            let count = 0;
            
            for (let i = 0; i < 4; i++) {
                if (landmarks[fingerTips[i]].y < landmarks[fingerMCPs[i]].y) {
                    count++;
                }
            }
            
            return count;
        }
        
        function isVSign(landmarks) {
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            
            return (indexTip.y < landmarks[6].y) &&
                   (middleTip.y < landmarks[10].y) &&
                   (ringTip.y > landmarks[14].y) &&
                   (pinkyTip.y > landmarks[18].y);
        }
        
        function isFingersDown(landmarks) {
            const fingerTips = [8, 12, 16, 20];
            const fingerMCPs = [5, 9, 13, 17];
            let count = 0;
            
            for (let i = 0; i < 4; i++) {
                if (landmarks[fingerTips[i]].y > landmarks[fingerMCPs[i]].y) {
                    count++;
                }
            }
            
            return count >= 3;
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ò–î–ï–û ==========
        function togglePlayPause() {
            if (!videoElement) return;
            
            if (videoElement.paused) {
                videoElement.play();
                showMessage('‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ', 'info');
                document.getElementById('playPauseBtn').innerHTML = '‚è∏Ô∏è';
            } else {
                videoElement.pause();
                showMessage('‚è∏Ô∏è –ü–∞—É–∑–∞', 'info');
                document.getElementById('playPauseBtn').innerHTML = '‚ñ∂Ô∏è';
            }
        }
        
        function toggleVolume() {
            if (!videoElement) return;
            
            videoElement.muted = !videoElement.muted;
            const isMuted = videoElement.muted;
            showMessage(isMuted ? 'üîá –ë–µ–∑ –∑–≤—É–∫–∞' : 'üîä –ó–≤—É–∫ –≤–∫–ª—é—á–µ–Ω', 'info');
            document.getElementById('volumeBtn').innerHTML = isMuted ? 'üîá' : 'üîä';
        }
        
        function deleteVideo() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã?')) {
                if (videoEntity) {
                    videoEntity.parentNode.removeChild(videoEntity);
                    videoEntity = null;
                    videoPlaced = false;
                    showMessage('üóëÔ∏è –í–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ', 'info');
                }
            }
        }
        
        function resetVideoPosition() {
            if (!videoEntity) return;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            videoWorldPosition = { x: 0, y: 1.6, z: -2 };
            videoWorldRotation = { x: 0, y: 0, z: 0 };
            videoScale = 1;
            
            videoEntity.setAttribute('position', videoWorldPosition);
            videoEntity.setAttribute('rotation', videoWorldRotation);
            videoEntity.setAttribute('scale', '1 1 1');
            
            showMessage('üîÑ –ü–æ–∑–∏—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                
                if (screenId === 'arScreen') {
                    isARActive = true;
                    document.getElementById('arStatus').className = 'status-dot green';
                } else {
                    isARActive = false;
                    if (handDetector) {
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É–∫
                        handDetector.close();
                        handDetector = null;
                    }
                }
            }
        }
        
        function goBackToMenu() {
            switchScreen('mainScreen');
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ò–î–ï–û –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú ==========
        function showVideoModal() {
            document.getElementById('videoModal').style.display = 'flex';
        }
        
        function hideVideoModal() {
            document.getElementById('videoModal').style.display = 'none';
            document.getElementById('youtubeUrlInput').value = '';
        }
        
        function handleVideoFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('video/')) {
                currentVideoUrl = URL.createObjectURL(file);
                currentVideoName = file.name;
                document.getElementById('confirmBtn').disabled = false;
                showMessage('‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
            }
        }
        
        function handleYouTubeUrl() {
            const url = document.getElementById('youtubeUrlInput').value.trim();
            if (!url) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É YouTube', 'error');
                return;
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –≤–∏–¥–µ–æ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ YouTube URL
            const videoId = extractYouTubeId(url);
            if (!videoId) {
                showMessage('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ YouTube', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º embed URL
            currentVideoUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&modestbranding=1&rel=0`;
            currentVideoName = 'YouTube –≤–∏–¥–µ–æ';
            document.getElementById('confirmBtn').disabled = false;
            
            showMessage('‚úÖ YouTube –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
        }
        
        function confirmVideoSelection() {
            hideVideoModal();
            showMessage('‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ AR!', 'success');
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function extractYouTubeId(url) {
            const patterns = [
                /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,
                /youtube\.com\/embed\/([^"&?\/\s]{11})/,
                /youtube\.com\/watch\?v=([^"&?\/\s]{11})/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            
            return null;
        }
        
        function showMessage(text, type = 'info') {
            console.log(`üí¨ ${text}`);
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 2000;
                font-size: 16px;
                text-align: center;
                max-width: 80%;
                animation: fadeInOut 3s ease;
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 3000);
        }
        
        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–ê –û–ö–ù–ê ==========
        window.addEventListener('resize', function() {
            if (handCanvas) {
                handCanvas.width = window.innerWidth;
                handCanvas.height = window.innerHeight;
            }
        });
        
        // ========== –î–ï–ë–ê–ì ==========
        window.debugInfo = function() {
            console.log('=== –î–ï–ë–ê–ì –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===');
            console.log('–í–∏–¥–µ–æ URL:', currentVideoUrl);
            console.log('–í–∏–¥–µ–æ –∏–º—è:', currentVideoName);
            console.log('AR –∞–∫—Ç–∏–≤–µ–Ω:', isARActive);
            console.log('–í–∏–¥–µ–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ:', videoPlaced);
            console.log('–í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç:', videoElement);
            console.log('–í–∏–¥–µ–æ entity:', videoEntity);
            console.log('–ú–∏—Ä–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è:', videoWorldPosition);
            console.log('–ó–∞—Ö–≤–∞—Ç —Ä—É–∫–∏:', isGrabbing);
        };
    </script>
</body>
</html>
