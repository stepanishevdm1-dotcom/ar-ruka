<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR –í–∏–¥–µ–æ —Å –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –†—É–∫–æ–π</title>
    
    <!-- MediaPipe –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    
    <!-- Three.js –¥–ª—è 3D –≥—Ä–∞—Ñ–∏–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- WebXR –¥–ª—è AR -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .screen.active {
            display: flex;
        }
        
        /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
        #loadingScreen {
            background: #0f3460;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .loader {
            text-align: center;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top-color: #4cc9f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .menu-content {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            color: #4cc9f0;
            margin-bottom: 15px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #a5b4cb;
            margin-bottom: 40px;
            line-height: 1.5;
            font-size: 16px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 12px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ */
        .upload-area {
            border: 3px dashed #4cc9f0;
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            margin: 25px 0;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .upload-area.dragover {
            background: rgba(76, 201, 240, 0.1);
            border-color: #4cc9f0;
        }
        
        .file-input {
            display: none;
        }
        
        .video-preview {
            margin-top: 25px;
            display: none;
        }
        
        .video-preview.active {
            display: block;
        }
        
        video {
            width: 100%;
            border-radius: 12px;
            margin: 15px 0;
            background: #000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instruction-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #4cc9f0;
        }
        
        /* AR —ç–∫—Ä–∞–Ω */
        #arScreen {
            padding: 0;
            background: #000;
        }
        
        #arCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #handCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .ar-controls {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
        }
        
        .control-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .control-btn:active {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(0.95);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∂–µ—Å—Ç–∞—Ö */
        .gesture-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 300px;
            z-index: 10;
        }
        
        .gesture-info h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        
        .gesture-list {
            list-style: none;
        }
        
        .gesture-list li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .gesture-list li:before {
            content: "üëâ";
            position: absolute;
            left: 0;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        #message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 90%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #message.active {
            display: block;
            animation: fadeInOut 3s ease;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 480px) {
            .gesture-info {
                display: none;
            }
            
            .ar-controls {
                bottom: 15px;
                padding: 12px 15px;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="screen active">
        <div class="loader">
            <div class="spinner"></div>
            <h1>AR –í–∏–¥–µ–æ —Å –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –†—É–∫–æ–π</h1>
            <p class="subtitle">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∂–µ—Å—Ç–æ–≤...</p>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="mainScreen" class="screen">
        <div class="menu-content">
            <h1>üé• AR –í–∏–¥–µ–æ —Å –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –†—É–∫–æ–π</h1>
            <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏–º –∂–µ—Å—Ç–∞–º–∏ –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏</p>
            
            <button id="startAR" class="btn btn-primary">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR —Å –∂–µ—Å—Ç–∞–º–∏
            </button>
            
            <button id="uploadVideo" class="btn btn-secondary">
                üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
            </button>
            
            <button id="showInstructions" class="btn btn-secondary">
                ‚ùì –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∂–µ—Å—Ç–∞–º
            </button>
            
            <div style="margin-top: 30px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                <p><strong>‚úã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–µ—Å—Ç–∞–º–∏:</strong></p>
                <p>‚Ä¢ –õ–∞–¥–æ–Ω—å –æ—Ç–∫—Ä—ã—Ç–∞ ‚Äî –ø–∞—É–∑–∞</p>
                <p>‚Ä¢ –ö—É–ª–∞–∫ ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</p>
                <p>‚Ä¢ –†—É–∫–∞ —Å–∂–∞—Ç–∞ ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ -->
    <div id="uploadScreen" class="screen">
        <button class="back-btn" id="backFromUpload">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="menu-content">
            <h1>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ</h1>
            <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è AR (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ YouTube URL)</p>
            
            <div class="upload-area" id="dropArea">
                <div style="font-size: 48px; margin-bottom: 15px;">üìπ</div>
                <h3>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∏–¥–µ–æ</h3>
                <p style="color: #a5b4cb; margin: 10px 0;">–ò–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                <p style="font-size: 14px; color: #7a8ca5;">MP4, WebM, YouTube —Å—Å—ã–ª–∫–∞</p>
            </div>
            
            <input type="file" id="videoInput" class="file-input" accept="video/*">
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(76,201,240,0.1); border-radius: 10px;">
                <h3 style="color: #4cc9f0; margin-bottom: 10px;">üé¨ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ YouTube</h3>
                <input type="text" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." 
                       style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #4cc9f0; background: rgba(255,255,255,0.1); color: white; font-size: 16px;">
                <button id="useYoutube" class="btn" style="margin-top: 10px; background: #ff0000; color: white;">
                    üì∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YouTube
                </button>
            </div>
            
            <div class="video-preview" id="videoPreview">
                <h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</h3>
                <video id="previewVideo" controls></video>
                <button id="useThisVideo" class="btn btn-primary">
                    ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤–∏–¥–µ–æ
                </button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π -->
    <div id="instructionsScreen" class="screen">
        <button class="back-btn" id="backFromInstructions">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="menu-content">
            <h1>üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∂–µ—Å—Ç–∞–º</h1>
            
            <div class="instruction-step">
                <h3>‚úã –û—Ç–∫—Ä—ã—Ç–∞—è –ª–∞–¥–æ–Ω—å</h3>
                <p>–í–∏–¥–µ–æ —Å—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ –ø–∞—É–∑—É. –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—É—é –ª–∞–¥–æ–Ω—å –∫–∞–º–µ—Ä–µ.</p>
            </div>
            
            <div class="instruction-step">
                <h3>‚úä –°–∂–∞—Ç—ã–π –∫—É–ª–∞–∫</h3>
                <p>–í–∏–¥–µ–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è. –°–æ–∂–º–∏—Ç–µ —Ä—É–∫—É –≤ –∫—É–ª–∞–∫.</p>
            </div>
            
            <div class="instruction-step">
                <h3>ü§è –©–µ–ø–æ—Ç–∫–∞ (–±–æ–ª—å—à–æ–π –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π)</h3>
                <p>–ó–∞—Ö–≤–∞—Ç –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–∏–¥–µ–æ. –°–æ–µ–¥–∏–Ω–∏—Ç–µ –±–æ–ª—å—à–æ–π –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–ª–µ—Ü.</p>
            </div>
            
            <div class="instruction-step">
                <h3>üñêÔ∏è –î–≤–∞ –ø–∞–ª—å—Ü–∞ –≤–≤–µ—Ä—Ö</h3>
                <p>–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏. –ü–æ–∫–∞–∂–∏—Ç–µ "V" –∑–Ω–∞–∫.</p>
            </div>
            
            <div class="instruction-step">
                <h3>üëá –î–≤–∞ –ø–∞–ª—å—Ü–∞ –≤–Ω–∏–∑</h3>
                <p>–£–º–µ–Ω—å—à–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏. –û–ø—É—Å—Ç–∏—Ç–µ –¥–≤–∞ –ø–∞–ª—å—Ü–∞ –≤–Ω–∏–∑.</p>
            </div>
            
            <div style="margin-top: 25px; padding: 20px; background: rgba(76, 201, 240, 0.1); border-radius: 12px;">
                <h3 style="color: #4cc9f0; margin-bottom: 10px;">üí° –°–æ–≤–µ—Ç—ã:</h3>
                <p>‚Ä¢ –î–µ—Ä–∂–∏—Ç–µ —Ä—É–∫—É —Ö–æ—Ä–æ—à–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ–π</p>
                <p>‚Ä¢ –†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 0.5-1 –º–µ—Ç—Ä–∞ –æ—Ç –∫–∞–º–µ—Ä—ã</p>
                <p>‚Ä¢ –î–µ–ª–∞–π—Ç–µ —á–µ—Ç–∫–∏–µ, —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –∂–µ—Å—Ç—ã</p>
            </div>
        </div>
    </div>

    <!-- AR —ç–∫—Ä–∞–Ω -->
    <div id="arScreen" class="screen">
        <canvas id="arCanvas"></canvas>
        <canvas id="handCanvas"></canvas>
        
        <button class="back-btn" id="backFromAR">‚Üê –ù–∞–∑–∞–¥</button>
        
        <div class="gesture-info">
            <h3>‚úã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–µ—Å—Ç–∞–º–∏:</h3>
            <ul class="gesture-list">
                <li>–û—Ç–∫—Ä—ã—Ç–∞—è –ª–∞–¥–æ–Ω—å ‚Äî –ü–∞—É–∑–∞</li>
                <li>–°–∂–∞—Ç—ã–π –∫—É–ª–∞–∫ ‚Äî Play</li>
                <li>–©–µ–ø–æ—Ç–∫–∞ ‚Äî –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</li>
                <li>V –∑–Ω–∞–∫ ‚Äî –ì—Ä–æ–º–∫–æ—Å—Ç—å +</li>
                <li>–û–ø—É—â–µ–Ω–Ω—ã–µ –ø–∞–ª—å—Ü—ã ‚Äî –ì—Ä–æ–º–∫–æ—Å—Ç—å -</li>
            </ul>
        </div>
        
        <div class="ar-controls">
            <button class="control-btn" id="playPauseBtn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
            <button class="control-btn" id="volumeBtn" title="–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫">üîä</button>
            <button class="control-btn" id="resetBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é">üîÑ</button>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="message"></div>

    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentVideoUrl = null;
        let currentVideoType = null; // 'file', 'youtube'
        let isARActive = false;
        let handDetector = null;
        let scene, camera, renderer, videoTexture, videoMesh;
        let handCanvas, handCtx;
        let isGrabbing = false;
        let videoElement = null;
        let videoPaused = false;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä—É–∫
            await initializeHandTracking();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setupEventListeners();
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            switchScreen('mainScreen');
            
            showMessage('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∂–µ—Å—Ç–æ–≤ –≥–æ—Ç–æ–≤–∞!', 'success');
        });

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–Ø –†–£–ö ==========
        async function initializeHandTracking() {
            console.log('‚úã –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaPipe Hands...');
            
            handCanvas = document.getElementById('handCanvas');
            handCtx = handCanvas.getContext('2d');
            
            handDetector = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });
            
            handDetector.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.7
            });
            
            handDetector.onResults(onHandResults);
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞—Ö–≤–∞—Ç —Å –≤–µ–±-–∫–∞–º–µ—Ä—ã
            const videoElement = document.createElement('video');
            videoElement.style.display = 'none';
            document.body.appendChild(videoElement);
            
            const camera = new Camera(videoElement, {
                onFrame: async () => {
                    if (isARActive) {
                        await handDetector.send({ image: videoElement });
                    }
                },
                width: 640,
                height: 480
            });
            
            await camera.start();
            console.log('‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–Ø –†–£–ö ==========
        function onHandResults(results) {
            // –û—á–∏—â–∞–µ–º canvas –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            handCtx.clearRect(0, 0, handCanvas.width, handCanvas.height);
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                
                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä—É–∫—É
                drawHand(landmarks);
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∂–µ—Å—Ç—ã
                analyzeGestures(landmarks);
            }
        }

        // ========== –û–¢–†–ò–°–û–í–ö–ê –†–£–ö–ò ==========
        function drawHand(landmarks) {
            handCtx.strokeStyle = '#00FF00';
            handCtx.lineWidth = 2;
            
            // –°–æ–µ–¥–∏–Ω—è–µ–º —Ç–æ—á–∫–∏ —Ä—É–∫–∏
            const connections = [
                [0, 1], [1, 2], [2, 3], [3, 4], // –ë–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü
                [0, 5], [5, 6], [6, 7], [7, 8], // –£–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π
                [0, 9], [9, 10], [10, 11], [11, 12], // –°—Ä–µ–¥–Ω–∏–π
                [0, 13], [13, 14], [14, 15], [15, 16], // –ë–µ–∑—ã–º—è–Ω–Ω—ã–π
                [0, 17], [17, 18], [18, 19], [19, 20] // –ú–∏–∑–∏–Ω–µ—Ü
            ];
            
            connections.forEach(connection => {
                const [i, j] = connection;
                const start = landmarks[i];
                const end = landmarks[j];
                
                handCtx.beginPath();
                handCtx.moveTo(start.x * handCanvas.width, start.y * handCanvas.height);
                handCtx.lineTo(end.x * handCanvas.width, end.y * handCanvas.height);
                handCtx.stroke();
            });
            
            // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏
            landmarks.forEach(landmark => {
                handCtx.beginPath();
                handCtx.arc(
                    landmark.x * handCanvas.width,
                    landmark.y * handCanvas.height,
                    3, 0, Math.PI * 2
                );
                handCtx.fillStyle = '#FF0000';
                handCtx.fill();
            });
        }

        // ========== –ê–ù–ê–õ–ò–ó –ñ–ï–°–¢–û–í ==========
        function analyzeGestures(landmarks) {
            if (!videoMesh || !videoElement) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            const wrist = landmarks[0];
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–Ω—á–∏–∫–∞–º–∏ –ø–∞–ª—å—Ü–µ–≤
            const pinchDistance = Math.sqrt(
                Math.pow(thumbTip.x - indexTip.x, 2) + 
                Math.pow(thumbTip.y - indexTip.y, 2)
            );
            
            // –ñ–ï–°–¢ 1: –©–µ–ø–æ—Ç–∫–∞ (–∑–∞—Ö–≤–∞—Ç –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
            if (pinchDistance < 0.05) {
                if (!isGrabbing) {
                    isGrabbing = true;
                    showMessage('ü§è –ó–∞—Ö–≤–∞—á–µ–Ω–æ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è', 'info');
                }
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä—É–∫–∏ –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
                const screenX = wrist.x * handCanvas.width;
                const screenY = wrist.y * handCanvas.height;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤–∏–¥–µ–æ
                updateVideoPosition(screenX, screenY);
            } else {
                if (isGrabbing) {
                    isGrabbing = false;
                    showMessage('üñêÔ∏è –û—Ç–ø—É—â–µ–Ω–æ', 'info');
                }
            }
            
            // –ñ–ï–°–¢ 2: –û—Ç–∫—Ä—ã—Ç–∞—è –ª–∞–¥–æ–Ω—å (–ø–∞—É–∑–∞)
            const fingersUp = countFingersUp(landmarks);
            if (fingersUp >= 4) { // –í—Å–µ –ø–∞–ª—å—Ü—ã –∫—Ä–æ–º–µ –±–æ–ª—å—à–æ–≥–æ
                if (!videoPaused) {
                    videoElement.pause();
                    videoPaused = true;
                    showMessage('‚úã –ü–∞—É–∑–∞', 'info');
                }
            }
            
            // –ñ–ï–°–¢ 3: –ö—É–ª–∞–∫ (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ)
            if (fingersUp <= 1) { // –í—Å–µ –ø–∞–ª—å—Ü—ã —Å–∂–∞—Ç—ã
                if (videoPaused) {
                    videoElement.play();
                    videoPaused = false;
                    showMessage('‚úä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ', 'info');
                }
            }
            
            // –ñ–ï–°–¢ 4: V –∑–Ω–∞–∫ (–≥—Ä–æ–º–∫–æ—Å—Ç—å +)
            if (isVSign(landmarks)) {
                if (videoElement.volume < 1) {
                    videoElement.volume = Math.min(1, videoElement.volume + 0.1);
                    showMessage('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å +', 'info');
                }
            }
            
            // –ñ–ï–°–¢ 5: –û–ø—É—â–µ–Ω–Ω—ã–µ –ø–∞–ª—å—Ü—ã (–≥—Ä–æ–º–∫–æ—Å—Ç—å -)
            if (isFingersDown(landmarks)) {
                if (videoElement.volume > 0) {
                    videoElement.volume = Math.max(0, videoElement.volume - 0.1);
                    showMessage('üîâ –ì—Ä–æ–º–∫–æ—Å—Ç—å -', 'info');
                }
            }
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ñ–ï–°–¢–û–í ==========
        function countFingersUp(landmarks) {
            const fingerTips = [8, 12, 16, 20]; // –ö–æ–Ω—á–∏–∫–∏ –ø–∞–ª—å—Ü–µ–≤ (–±–µ–∑ –±–æ–ª—å—à–æ–≥–æ)
            const fingerMCPs = [5, 9, 13, 17]; // –°—É—Å—Ç–∞–≤—ã –ø–∞–ª—å—Ü–µ–≤
            
            let count = 0;
            
            for (let i = 0; i < 4; i++) {
                const tip = landmarks[fingerTips[i]];
                const mcp = landmarks[fingerMCPs[i]];
                
                if (tip.y < mcp.y) { // –ü–∞–ª–µ—Ü –ø–æ–¥–Ω—è—Ç
                    count++;
                }
            }
            
            return count;
        }

        function isVSign(landmarks) {
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –∏ —Å—Ä–µ–¥–Ω–∏–π –ø–∞–ª—å—Ü—ã –ø–æ–¥–Ω—è—Ç—ã,
            // –∞ –±–µ–∑—ã–º—è–Ω–Ω—ã–π –∏ –º–∏–∑–∏–Ω–µ—Ü –æ–ø—É—â–µ–Ω—ã
            return (indexTip.y < landmarks[6].y) && // –£–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥–Ω—è—Ç
                   (middleTip.y < landmarks[10].y) && // –°—Ä–µ–¥–Ω–∏–π –ø–æ–¥–Ω—è—Ç
                   (ringTip.y > landmarks[14].y) && // –ë–µ–∑—ã–º—è–Ω–Ω—ã–π –æ–ø—É—â–µ–Ω
                   (pinkyTip.y > landmarks[18].y); // –ú–∏–∑–∏–Ω–µ—Ü –æ–ø—É—â–µ–Ω
        }

        function isFingersDown(landmarks) {
            const fingerTips = [8, 12, 16, 20];
            const fingerMCPs = [5, 9, 13, 17];
            
            let count = 0;
            
            for (let i = 0; i < 4; i++) {
                const tip = landmarks[fingerTips[i]];
                const mcp = landmarks[fingerMCPs[i]];
                
                if (tip.y > mcp.y) { // –ü–∞–ª–µ—Ü –æ–ø—É—â–µ–Ω
                    count++;
                }
            }
            
            return count >= 3; // –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–∞–ª—å—Ü–µ–≤ –æ–ø—É—â–µ–Ω–æ
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ò –í–ò–î–ï–û ==========
        function updateVideoPosition(screenX, screenY) {
            if (!videoMesh) return;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–∫—Ä–∞–Ω–∞ –≤ 3D
            const x = (screenX / handCanvas.width) * 2 - 1;
            const y = -(screenY / handCanvas.height) * 2 + 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤–∏–¥–µ–æ
            videoMesh.position.x = x * 3;
            videoMesh.position.y = y * 2;
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø THREE.JS –ò AR ==========
        async function initAR() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR —Å—Ü–µ–Ω—ã...');
            
            const arCanvas = document.getElementById('arCanvas');
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
            camera = new THREE.PerspectiveCamera(
                60, window.innerWidth / window.innerHeight, 0.1, 1000
            );
            camera.position.set(0, 1.6, 3);
            
            // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({
                canvas: arCanvas,
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—Ç
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ
            await loadVideoInAR();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            animate();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', onWindowResize);
            
            console.log('‚úÖ AR —Å—Ü–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û –í AR ==========
        async function loadVideoInAR() {
            if (!currentVideoUrl) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                currentVideoUrl = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
                currentVideoType = 'file';
            }
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
            videoElement = document.createElement('video');
            videoElement.src = currentVideoUrl;
            videoElement.crossOrigin = 'anonymous';
            videoElement.loop = true;
            videoElement.muted = true;
            videoElement.playsInline = true;
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
            await new Promise((resolve) => {
                videoElement.addEventListener('loadedmetadata', () => {
                    videoElement.play().then(resolve).catch(() => {
                        // –ï—Å–ª–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                        resolve();
                    });
                });
                
                videoElement.load();
            });
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –∏–∑ –≤–∏–¥–µ–æ
            videoTexture = new THREE.VideoTexture(videoElement);
            videoTexture.minFilter = THREE.LinearFilter;
            videoTexture.magFilter = THREE.LinearFilter;
            videoTexture.format = THREE.RGBFormat;
            
            // –°–æ–∑–¥–∞–µ–º –ø–ª–æ—Å–∫–æ—Å—Ç—å –¥–ª—è –≤–∏–¥–µ–æ
            const videoWidth = 3;
            const videoHeight = videoWidth * (videoElement.videoHeight / videoElement.videoWidth);
            
            const geometry = new THREE.PlaneGeometry(videoWidth, videoHeight);
            const material = new THREE.MeshBasicMaterial({
                map: videoTexture,
                side: THREE.DoubleSide,
                transparent: true
            });
            
            videoMesh = new THREE.Mesh(geometry, material);
            videoMesh.position.set(0, 0, -5);
            scene.add(videoMesh);
            
            console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ AR');
        }

        // ========== –ê–ù–ò–ú–ê–¶–ò–Ø ==========
        function animate() {
            if (!isARActive) return;
            
            requestAnimationFrame(animate);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–µ–æ —Ç–µ–∫—Å—Ç—É—Ä—É
            if (videoTexture) {
                videoTexture.needsUpdate = true;
            }
            
            // –í—Ä–∞—â–∞–µ–º –≤–∏–¥–µ–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–±–∑–æ—Ä–∞
            if (videoMesh) {
                videoMesh.lookAt(camera.position);
            }
            
            renderer.render(scene, camera);
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–ê ==========
        function onWindowResize() {
            if (!camera || !renderer) return;
            
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º canvas –¥–ª—è —Ä—É–∫
            handCanvas.width = window.innerWidth;
            handCanvas.height = window.innerHeight;
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
        function switchScreen(screenId) {
            const screens = ['loadingScreen', 'mainScreen', 'uploadScreen', 'instructionsScreen', 'arScreen'];
            screens.forEach(id => {
                document.getElementById(id)?.classList.remove('active');
            });
            
            document.getElementById(screenId)?.classList.add('active');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ AR —ç–∫—Ä–∞–Ω
            if (screenId === 'arScreen') {
                startARMode();
            } else if (isARActive) {
                stopARMode();
            }
        }

        function startARMode() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ AR —Ä–µ–∂–∏–º–∞...');
            isARActive = true;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AR —Å—Ü–µ–Ω—É
            initAR();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            onWindowResize();
            
            showMessage('AR —Ä–µ–∂–∏–º —Å –∂–µ—Å—Ç–æ–≤—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', 'success');
        }

        function stopARMode() {
            console.log('üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ AR —Ä–µ–∂–∏–º–∞...');
            isARActive = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ
            if (videoElement) {
                videoElement.pause();
            }
            
            // –û—á–∏—â–∞–µ–º —Å—Ü–µ–Ω—É
            if (scene) {
                scene.clear();
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ì–†–£–ó–ö–ò –í–ò–î–ï–û ==========
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.getElementById('startAR').addEventListener('click', () => {
                if (!currentVideoUrl) {
                    showMessage('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ!', 'warning');
                    return;
                }
                switchScreen('arScreen');
            });
            
            document.getElementById('uploadVideo').addEventListener('click', () => switchScreen('uploadScreen'));
            document.getElementById('showInstructions').addEventListener('click', () => switchScreen('instructionsScreen'));
            
            // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
            document.getElementById('backFromUpload').addEventListener('click', () => switchScreen('mainScreen'));
            document.getElementById('backFromInstructions').addEventListener('click', () => switchScreen('mainScreen'));
            document.getElementById('backFromAR').addEventListener('click', () => switchScreen('mainScreen'));
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
            const videoInput = document.getElementById('videoInput');
            const dropArea = document.getElementById('dropArea');
            
            videoInput.addEventListener('change', handleVideoSelect);
            dropArea.addEventListener('click', () => videoInput.click());
            
            // Drag and drop
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    handleVideoFile(e.dataTransfer.files[0]);
                }
            });
            
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ YouTube
            document.getElementById('useYoutube').addEventListener('click', () => {
                const url = document.getElementById('youtubeUrl').value;
                if (url) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º YouTube URL –≤ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ
                    const videoId = extractYouTubeId(url);
                    if (videoId) {
                        currentVideoUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0`;
                        currentVideoType = 'youtube';
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                        const previewVideo = document.getElementById('previewVideo');
                        previewVideo.src = currentVideoUrl;
                        document.getElementById('videoPreview').classList.add('active');
                        
                        showMessage('‚úÖ YouTube –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', 'success');
                    } else {
                        showMessage('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ YouTube', 'error');
                    }
                }
            });
            
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
            document.getElementById('useThisVideo').addEventListener('click', () => {
                if (currentVideoUrl) {
                    showMessage('‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ AR!', 'success');
                    switchScreen('mainScreen');
                }
            });
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AR
            document.getElementById('playPauseBtn').addEventListener('click', () => {
                if (videoElement) {
                    if (videoElement.paused) {
                        videoElement.play();
                        showMessage('‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ', 'info');
                    } else {
                        videoElement.pause();
                        showMessage('‚è∏Ô∏è –ü–∞—É–∑–∞', 'info');
                    }
                }
            });
            
            document.getElementById('volumeBtn').addEventListener('click', () => {
                if (videoElement) {
                    videoElement.muted = !videoElement.muted;
                    showMessage(videoElement.muted ? 'üîá –ë–µ–∑ –∑–≤—É–∫–∞' : 'üîä –ó–≤—É–∫ –≤–∫–ª—é—á–µ–Ω', 'info');
                }
            });
            
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (videoMesh) {
                    videoMesh.position.set(0, 0, -5);
                    showMessage('üîÑ –ü–æ–∑–∏—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
                }
            });
        }

        function handleVideoSelect(event) {
            const file = event.target.files[0];
            if (file) handleVideoFile(file);
        }

        function handleVideoFile(file) {
            if (!file.type.startsWith('video/')) {
                showMessage('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'error');
                return;
            }
            
            currentVideoFile = file;
            currentVideoUrl = URL.createObjectURL(file);
            currentVideoType = 'file';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const previewVideo = document.getElementById('previewVideo');
            previewVideo.src = currentVideoUrl;
            document.getElementById('videoPreview').classList.add('active');
            
            showMessage('‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'success');
            
            // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            previewVideo.play().catch(e => console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'));
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function extractYouTubeId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message');
            if (!messageEl) return;
            
            const colors = {
                'success': '#4CAF50',
                'error': '#f44336',
                'warning': '#ff9800',
                'info': '#2196F3'
            };
            
            messageEl.textContent = text;
            messageEl.style.backgroundColor = colors[type] || colors.info;
            messageEl.classList.add('active');
            
            setTimeout(() => {
                messageEl.classList.remove('active');
            }, 3000);
            
            console.log(`üí¨ ${text}`);
        }

        // ========== –î–ï–ë–ê–ì ==========
        window.debugApp = function() {
            console.log('=== –î–ï–ë–ê–ì –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===');
            console.log('–¢–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ URL:', currentVideoUrl);
            console.log('–¢–∏–ø –≤–∏–¥–µ–æ:', currentVideoType);
            console.log('AR –∞–∫—Ç–∏–≤–µ–Ω:', isARActive);
            console.log('–ó–∞—Ö–≤–∞—Ç —Ä—É–∫–∏:', isGrabbing);
            console.log('–í–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑–µ:', videoPaused);
        };
    </script>
</body>
</html>
